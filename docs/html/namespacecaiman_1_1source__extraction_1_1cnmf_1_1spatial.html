<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Caiman: caiman.source_extraction.cnmf.spatial Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Caiman_logo_FIsmall.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Caiman
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">A Computational toolbox for large scale Calcium Imaging Analysis</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">caiman.source_extraction.cnmf.spatial Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac4b406f52054893ed2518a761921d4f4"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html#ac4b406f52054893ed2518a761921d4f4">update_spatial_components</a> (Y, C=None, f=None, A_in=None, sn=None, dims=None, min_size=3, max_size=8, dist=3, normalize_yyt_one=True, method='ellipse', expandCore=None, dview=None, n_pixels_per_process=128, medw=(3, 3), thr_method='nrg', maxthr=0.1, nrgthr=0.9999, extract_cc=True, se=np.ones((3, 3), dtype=np.int), ss=np.ones((3, 3), dtype=np.int), nb=1, method_ls='lasso_lars')</td></tr>
<tr class="memdesc:ac4b406f52054893ed2518a761921d4f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">update spatial footprints and background through Basis Pursuit Denoising  <a href="#ac4b406f52054893ed2518a761921d4f4">More...</a><br /></td></tr>
<tr class="separator:ac4b406f52054893ed2518a761921d4f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3e32db8a5aeabf7269b756732a5e5a1"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html#af3e32db8a5aeabf7269b756732a5e5a1">regression_ipyparallel</a> (pars)</td></tr>
<tr class="memdesc:af3e32db8a5aeabf7269b756732a5e5a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">update spatial footprints and background through Basis Pursuit Denoising  <a href="#af3e32db8a5aeabf7269b756732a5e5a1">More...</a><br /></td></tr>
<tr class="separator:af3e32db8a5aeabf7269b756732a5e5a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca0edbf4c2cd31fe1a9c228c4099a485"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html#aca0edbf4c2cd31fe1a9c228c4099a485">determine_search_location</a> (A, dims, method='ellipse', min_size=3, max_size=8, dist=3, expandCore=iterate_structure(generate_binary_structure(2, 1), 2).astype(int), dview=None)</td></tr>
<tr class="memdesc:aca0edbf4c2cd31fe1a9c228c4099a485"><td class="mdescLeft">&#160;</td><td class="mdescRight">compute the indices of the distance from the cm to search for the spatial component  <a href="#aca0edbf4c2cd31fe1a9c228c4099a485">More...</a><br /></td></tr>
<tr class="separator:aca0edbf4c2cd31fe1a9c228c4099a485"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af13bc36a039c086083d6261d6e70d4a6"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html#af13bc36a039c086083d6261d6e70d4a6">construct_ellipse_parallel</a> (pars)</td></tr>
<tr class="memdesc:af13bc36a039c086083d6261d6e70d4a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">update spatial footprints and background through Basis Pursuit Denoising  <a href="#af13bc36a039c086083d6261d6e70d4a6">More...</a><br /></td></tr>
<tr class="separator:af13bc36a039c086083d6261d6e70d4a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fa5db8c88b06457233eb35dbcea3588"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html#a3fa5db8c88b06457233eb35dbcea3588">threshold_components</a> (A, dims, medw=None, thr_method='nrg', maxthr=0.1, nrgthr=0.9999, extract_cc=True, se=None, ss=None, dview=None)</td></tr>
<tr class="memdesc:a3fa5db8c88b06457233eb35dbcea3588"><td class="mdescLeft">&#160;</td><td class="mdescRight">Post-processing of spatial components which includes the following steps.  <a href="#a3fa5db8c88b06457233eb35dbcea3588">More...</a><br /></td></tr>
<tr class="separator:a3fa5db8c88b06457233eb35dbcea3588"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1e38e003b38148972586354723e9bc4"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html#aa1e38e003b38148972586354723e9bc4">threshold_components_parallel</a> (pars)</td></tr>
<tr class="memdesc:aa1e38e003b38148972586354723e9bc4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Post-processing of spatial components which includes the following steps.  <a href="#aa1e38e003b38148972586354723e9bc4">More...</a><br /></td></tr>
<tr class="separator:aa1e38e003b38148972586354723e9bc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86e3328b66dc7efa75c0646f02815ab4"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html#a86e3328b66dc7efa75c0646f02815ab4">nnls_L0</a> (X, Yp, noise)</td></tr>
<tr class="memdesc:a86e3328b66dc7efa75c0646f02815ab4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Nonnegative least square with L0 penalty.  <a href="#a86e3328b66dc7efa75c0646f02815ab4">More...</a><br /></td></tr>
<tr class="separator:a86e3328b66dc7efa75c0646f02815ab4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f8a2090fe45b30f032bf6ec1a91c1ce"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html#a6f8a2090fe45b30f032bf6ec1a91c1ce">lars_regression_noise_old</a> (Yp, X, positive, noise, verbose=False)</td></tr>
<tr class="memdesc:a6f8a2090fe45b30f032bf6ec1a91c1ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run LARS for regression problems with LASSO penalty, with optional positivity constraints.  <a href="#a6f8a2090fe45b30f032bf6ec1a91c1ce">More...</a><br /></td></tr>
<tr class="separator:a6f8a2090fe45b30f032bf6ec1a91c1ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14912eb4a48c8e566545bb4392341d04"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html#a14912eb4a48c8e566545bb4392341d04">calcAvec</a> (new, dQ, W, lambda_, active_set, M, positive)</td></tr>
<tr class="memdesc:a14912eb4a48c8e566545bb4392341d04"><td class="mdescLeft">&#160;</td><td class="mdescRight">calculate the vectoe to travel along  <a href="#a14912eb4a48c8e566545bb4392341d04">More...</a><br /></td></tr>
<tr class="separator:a14912eb4a48c8e566545bb4392341d04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a618870d89b38009e6444a12357a31d3d"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html#a618870d89b38009e6444a12357a31d3d">test</a> (Y, A_in, C, f, n_pixels_per_process, nb)</td></tr>
<tr class="memdesc:a618870d89b38009e6444a12357a31d3d"><td class="mdescLeft">&#160;</td><td class="mdescRight">test the shape of each matrix, reshape them, test the number of pixel per process  <a href="#a618870d89b38009e6444a12357a31d3d">More...</a><br /></td></tr>
<tr class="separator:a618870d89b38009e6444a12357a31d3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecc215caf3e87682f452e93ca491a477"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html#aecc215caf3e87682f452e93ca491a477">computing_indicator</a> (Y, A_in, C, f, nb, method, dims, min_size, max_size, dist, expandCore, dview)</td></tr>
<tr class="memdesc:aecc215caf3e87682f452e93ca491a477"><td class="mdescLeft">&#160;</td><td class="mdescRight">compute the indices of the distance from the cm to search for the spatial component (calling determine_search_location)  <a href="#aecc215caf3e87682f452e93ca491a477">More...</a><br /></td></tr>
<tr class="separator:aecc215caf3e87682f452e93ca491a477"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a894e2773dd1e79c2efac3c759ff2fe9c"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html#a894e2773dd1e79c2efac3c759ff2fe9c">creatememmap</a> (Y, Cf, dview)</td></tr>
<tr class="memdesc:a894e2773dd1e79c2efac3c759ff2fe9c"><td class="mdescLeft">&#160;</td><td class="mdescRight">memmap the C and Y objects in parallel  <a href="#a894e2773dd1e79c2efac3c759ff2fe9c">More...</a><br /></td></tr>
<tr class="separator:a894e2773dd1e79c2efac3c759ff2fe9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a14912eb4a48c8e566545bb4392341d04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14912eb4a48c8e566545bb4392341d04">&#9670;&nbsp;</a></span>calcAvec()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.source_extraction.cnmf.spatial.calcAvec </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>new</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dQ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>W</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>lambda_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>active_set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>M</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>positive</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>calculate the vectoe to travel along </p>
<p>used in the lars regression function</p>
<h2>Parameters </h2>
<p>Y np.ndarray (2D or 3D) movie, raw data in 2D or 3D (pixels x time).</p>
<p>Cf np.ndarray calcium activity of each neuron + background components</p>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>C_name string the memmaped name of Cf</dd>
<dd>
Y_name string the memmaped name of Y </dd></dl>

<p class="definition">Definition at line <a class="el" href="spatial_8py_source.html#l00937">937</a> of file <a class="el" href="spatial_8py_source.html">spatial.py</a>.</p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_a14912eb4a48c8e566545bb4392341d04_icgraph.svg" width="515" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aecc215caf3e87682f452e93ca491a477"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aecc215caf3e87682f452e93ca491a477">&#9670;&nbsp;</a></span>computing_indicator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.source_extraction.cnmf.spatial.computing_indicator </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>A_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>C</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>nb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>min_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>expandCore</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dview</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>compute the indices of the distance from the cm to search for the spatial component (calling determine_search_location) </p>
<p>does it by following an ellipse from the cm or doing a step by step dilatation around the cm if it doesn't follow the rules it will throw an exception that is not supposed to be catch by spatial.</p>
<h2>Parameters </h2>
<p>Y np.ndarray (2D or 3D) movie, raw data in 2D or 3D (pixels x time).</p>
<p>C np.ndarray calcium activity of each neuron.</p>
<p>f np.ndarray temporal profile of background activity.</p>
<p>A_in np.ndarray spatial profile of background activity. If A_in is boolean then it defines the spatial support of A. Otherwise it is used to determine it through determine_search_location</p>
<p>n_pixels_per_process [optional] int number of pixels to be processed by each thread</p>
<p>min_size [optional] int</p>
<p>max_size [optional] int</p>
<p>dist [optional] int</p>
<p>dims [optional] tuple x, y[, z] movie dimensions</p>
<p>method [optional] string method used to expand the search for pixels 'ellipse' or 'dilate'</p>
<p>expandCore [optional] scipy.ndimage.morphology if method is dilate this represents the kernel used for expansion</p>
<h2></h2>
<p>same: but reshaped and tested</p>
<h2>Raise </h2>
<p>Exception('You need to define the input dimensions')</p>
<p>Exception('Dimension of Matrix Y must be pixels x time')</p>
<p>Exception('Dimension of Matrix C must be neurons x time')</p>
<p>Exception('Dimension of Matrix f must be background comps x time ')</p>
<p>Exception('Either A or C need to be determined')</p>
<p>Exception('Dimension of Matrix A must be pixels x neurons ')</p>
<p>Exception('You need to provide estimate of C and f')</p>
<p>Exception('Not implemented consistently')</p>
<p>Exception("Failed to delete: " + folder) </p>

<p class="definition">Definition at line <a class="el" href="spatial_8py_source.html#l01113">1113</a> of file <a class="el" href="spatial_8py_source.html">spatial.py</a>.</p>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_aecc215caf3e87682f452e93ca491a477_cgraph.svg" width="384" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_aecc215caf3e87682f452e93ca491a477_icgraph.svg" width="739" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af13bc36a039c086083d6261d6e70d4a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af13bc36a039c086083d6261d6e70d4a6">&#9670;&nbsp;</a></span>construct_ellipse_parallel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.source_extraction.cnmf.spatial.construct_ellipse_parallel </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>pars</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>update spatial footprints and background through Basis Pursuit Denoising </p>
<p>for each pixel i solve the problem [A(i,:),b(i)] = argmin sum(A(i,:)) subject to || Y(i,:) - A(i,:)*C + b(i)*f || &lt;= sn(i)*sqrt(T);</p>
<p>for each pixel the search is limited to a few spatial components</p>
<h2>Parameters </h2>
<p>[parsed] cm[i]: center of mass of each neuron</p>
<p>A[:, i]: the A of each components</p>
<dl class="section user"><dt>Vr</dt><dd></dd></dl>
<p>dims: the dimension of each A's ( same usually )</p>
<p>dist: computed distance matrix</p>
<p>min_size [optional] int</p>
<p>max_size [optional] int</p>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>dist np.ndarray new estimate of spatial footprints</dd></dl>
<h2>Raise </h2>
<p>Exception('You cannot pass empty (all zeros) components!') </p>

<p class="definition">Definition at line <a class="el" href="spatial_8py_source.html#l00483">483</a> of file <a class="el" href="spatial_8py_source.html">spatial.py</a>.</p>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_af13bc36a039c086083d6261d6e70d4a6_cgraph.svg" width="390" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a894e2773dd1e79c2efac3c759ff2fe9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a894e2773dd1e79c2efac3c759ff2fe9c">&#9670;&nbsp;</a></span>creatememmap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.source_extraction.cnmf.spatial.creatememmap </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>Cf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dview</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>memmap the C and Y objects in parallel </p>
<p>the memmaped object will be red during parallelized computation such as the regression function</p>
<h2>Parameters </h2>
<p>Y np.ndarray (2D or 3D) movie, raw data in 2D or 3D (pixels x time).</p>
<p>Cf np.ndarray calcium activity of each neuron + background components</p>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>C_name string the memmaped name of Cf</dd>
<dd>
Y_name string the memmaped name of Y</dd></dl>
<hr/>
 <div class="fragment"><div class="line">Exception(<span class="stringliteral">&#39;Not implemented consistently&#39;</span>)</div></div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="spatial_8py_source.html#l01169">1169</a> of file <a class="el" href="spatial_8py_source.html">spatial.py</a>.</p>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_a894e2773dd1e79c2efac3c759ff2fe9c_cgraph.svg" width="334" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_a894e2773dd1e79c2efac3c759ff2fe9c_icgraph.svg" width="712" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aca0edbf4c2cd31fe1a9c228c4099a485"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca0edbf4c2cd31fe1a9c228c4099a485">&#9670;&nbsp;</a></span>determine_search_location()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.source_extraction.cnmf.spatial.determine_search_location </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>method</em> = <code>'ellipse'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>min_size</em> = <code>3</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_size</em> = <code>8</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dist</em> = <code>3</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>expandCore</em> = <code>iterate_structure(generate_binary_structure(2,&#160;1),&#160;2).astype(int)</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dview</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>compute the indices of the distance from the cm to search for the spatial component </p>
<p>does it by following an ellipse from the cm or doing a step by step dilatation around the cm</p>
<h2>Parameters </h2>
<p>[parsed] cm[i]: center of mass of each neuron</p>
<p>A[:, i]: the A of each components</p>
<p>dims: the dimension of each A's ( same usually )</p>
<p>dist: computed distance matrix</p>
<p>dims [optional] tuple x, y[, z] movie dimensions</p>
<p>method [optional] string method used to expand the search for pixels 'ellipse' or 'dilate'</p>
<p>expandCore [optional] scipy.ndimage.morphology if method is dilate this represents the kernel used for expansion</p>
<p>min_size [optional] int</p>
<p>max_size [optional] int</p>
<p>dist [optional] int</p>
<p>dims [optional] tuple x, y[, z] movie dimensions</p>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>dist_indicator np.ndarray distance from the cm to search for the spatial footprint</dd></dl>
<h2>Raise </h2>
<p>Exception('You cannot pass empty (all zeros) components!') </p>

<p class="definition">Definition at line <a class="el" href="spatial_8py_source.html#l00376">376</a> of file <a class="el" href="spatial_8py_source.html">spatial.py</a>.</p>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_aca0edbf4c2cd31fe1a9c228c4099a485_icgraph.svg" width="982" height="95"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a6f8a2090fe45b30f032bf6ec1a91c1ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f8a2090fe45b30f032bf6ec1a91c1ce">&#9670;&nbsp;</a></span>lars_regression_noise_old()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.source_extraction.cnmf.spatial.lars_regression_noise_old </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>Yp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>positive</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>noise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>verbose</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Run LARS for regression problems with LASSO penalty, with optional positivity constraints. </p>
<dl class="section author"><dt>Author</dt><dd>: Andrea Giovannucci. Adapted code from Eftychios Pnevmatikakis</dd></dl>
<h2>Parameters </h2>
<p>Yp Yp[:,t] is the observed data at time t </p><dl class="section user"><dt></dt><dd>X the regresion problem is Yp=X*W + noise </dd></dl>
<dl class="section user"><dt></dt><dd>maxcomps maximum number of active components to allow </dd></dl>
<dl class="section user"><dt></dt><dd>positive a flag to enforce positivity </dd></dl>
<dl class="section user"><dt></dt><dd>noise the noise of the observation equation. if it is not provided as an argument, the noise is computed from the variance at the end point of the algorithm. The noise is used in the computation of the Cp criterion.</dd></dl>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>Ws weights from each iteration </dd>
<dd>
lambdas lambda_ values at each iteration</dd>
<dd>
Cps C_p estimates </dd>
<dd>
last_break last_break(m) == n means that the last break with m non-zero weights is at Ws(:,:,n)</dd></dl>
<hr/>
 <dl class="section see"><dt>See also</dt><dd>LARS <a href="https://en.wikipedia.org/wiki/Least-angle_regression">https://en.wikipedia.org/wiki/Least-angle_regression</a> group Lasso : </dd></dl>

<p class="definition">Definition at line <a class="el" href="spatial_8py_source.html#l00752">752</a> of file <a class="el" href="spatial_8py_source.html">spatial.py</a>.</p>
<div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_a6f8a2090fe45b30f032bf6ec1a91c1ce_cgraph.svg" width="315" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_a6f8a2090fe45b30f032bf6ec1a91c1ce_icgraph.svg" width="390" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a86e3328b66dc7efa75c0646f02815ab4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86e3328b66dc7efa75c0646f02815ab4">&#9670;&nbsp;</a></span>nnls_L0()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.source_extraction.cnmf.spatial.nnls_L0 </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>Yp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>noise</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Nonnegative least square with L0 penalty. </p>
<p>It will basically call the scipy function with some tests we want to minimize : min|| Yp-W_lam*X||**2 &lt;= noise with ||W_lam||_0 penalty and W_lam &gt;0</p>
<h2>Parameters </h2>
<p>X np.array the input parameter ((the regressor</p>
<p>Y np.array ((the regressand</p>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>W_lam np.array the learned weight matrices ((Models </dd></dl>

<p class="definition">Definition at line <a class="el" href="spatial_8py_source.html#l00697">697</a> of file <a class="el" href="spatial_8py_source.html">spatial.py</a>.</p>
<div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_a86e3328b66dc7efa75c0646f02815ab4_icgraph.svg" width="280" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af3e32db8a5aeabf7269b756732a5e5a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3e32db8a5aeabf7269b756732a5e5a1">&#9670;&nbsp;</a></span>regression_ipyparallel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.source_extraction.cnmf.spatial.regression_ipyparallel </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>pars</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>update spatial footprints and background through Basis Pursuit Denoising </p>
<p>for each pixel i solve the problem [A(i,:),b(i)] = argmin sum(A(i,:)) subject to || Y(i,:) - A(i,:)*C + b(i)*f || &lt;= sn(i)*sqrt(T);</p>
<p>for each pixel the search is limited to a few spatial components</p>
<h2>Parameters </h2>
<p>C_name string memmap C</p>
<p>Y_name string memmap Y</p>
<p>idxs_Y np.array indices of the Calcium traces for each computed components</p>
<p>idxs_C np.array indices of the Calcium traces for each computed components</p>
<p>method_least_square: method to perform the regression for the basis pursuit denoising. 'nnls_L0'. Nonnegative least square with L0 penalty 'lasso_lars' lasso lars function from scikit learn 'lasso_lars_old' lasso lars from old implementation, will be deprecated</p>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>px np.ndarray positions o the regression</dd>
<dd>
idxs_C np.ndarray indices of the Calcium traces for each computed components</dd>
<dd>
a learned weight</dd></dl>
<hr/>
<p> Exception('Least Square Method not found!' </p>

<p class="definition">Definition at line <a class="el" href="spatial_8py_source.html#l00268">268</a> of file <a class="el" href="spatial_8py_source.html">spatial.py</a>.</p>
<div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_af3e32db8a5aeabf7269b756732a5e5a1_cgraph.svg" width="520" height="204"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a618870d89b38009e6444a12357a31d3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a618870d89b38009e6444a12357a31d3d">&#9670;&nbsp;</a></span>test()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.source_extraction.cnmf.spatial.test </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>A_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>C</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>n_pixels_per_process</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>nb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>test the shape of each matrix, reshape them, test the number of pixel per process </p>
<p>if it doesn't follow the rules it will throw an exception that is not supposed to be catch by spatial.</p>
<h2>Parameters </h2>
<p>Y np.ndarray (2D or 3D) movie, raw data in 2D or 3D (pixels x time).</p>
<p>C np.ndarray calcium activity of each neuron.</p>
<p>f np.ndarray temporal profile of background activity.</p>
<p>A_in np.ndarray spatial profile of background activity. If A_in is boolean then it defines the spatial support of A. Otherwise it is used to determine it through determine_search_location</p>
<p>n_pixels_per_process [optional] int number of pixels to be processed by each thread</p>
<h2></h2>
<p>same: but reshaped and tested</p>
<h2>Raise </h2>
<p>Exception('You need to define the input dimensions') Exception('Dimension of Matrix Y must be pixels x time') Exception('Dimension of Matrix C must be neurons x time') Exception('Dimension of Matrix f must be background comps x time ') Exception('Either A or C need to be determined') Exception('Dimension of Matrix A must be pixels x neurons ') Exception('You need to provide estimate of C and f') Exception('Not implemented consistently') Exception("Failed to delete: " + folder) </p>

<p class="definition">Definition at line <a class="el" href="spatial_8py_source.html#l01009">1009</a> of file <a class="el" href="spatial_8py_source.html">spatial.py</a>.</p>
<div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_a618870d89b38009e6444a12357a31d3d_icgraph.svg" width="643" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a3fa5db8c88b06457233eb35dbcea3588"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fa5db8c88b06457233eb35dbcea3588">&#9670;&nbsp;</a></span>threshold_components()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.source_extraction.cnmf.spatial.threshold_components </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>medw</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>thr_method</em> = <code>'nrg'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>maxthr</em> = <code>0.1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>nrgthr</em> = <code>0.9999</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>extract_cc</em> = <code>True</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>se</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ss</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dview</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Post-processing of spatial components which includes the following steps. </p>
<p>(i) Median filtering (ii) Thresholding (iii) Morphological closing of spatial support (iv) Extraction of largest connected component</p>
<h2>Parameters </h2>
<p>A np.ndarray 2d matrix with spatial components</p>
<p>dims tuple dimensions of spatial components</p>
<p>medw [optional] tuple window of median filter</p>
<p>thr_method [optional] string Method of thresholding: 'max' sets to zero pixels that have value less than a fraction of the max value 'nrg' keeps the pixels that contribute up to a specified fraction of the energy</p>
<p>maxthr [optional] scalar Threshold of max value</p>
<p>nrgthr [optional] scalar Threshold of energy</p>
<p>extract_cc [optional] bool Flag to extract connected components (might want to turn to False for dendritic imaging)</p>
<p>se [optional] np.intarray Morphological closing structuring element</p>
<p>ss [optinoal] np.intarray Binary element for determining connectivity</p>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>Ath np.ndarray 2d matrix with spatial components thresholded </dd></dl>

<p class="definition">Definition at line <a class="el" href="spatial_8py_source.html#l00549">549</a> of file <a class="el" href="spatial_8py_source.html">spatial.py</a>.</p>
<div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_a3fa5db8c88b06457233eb35dbcea3588_icgraph.svg" width="755" height="95"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa1e38e003b38148972586354723e9bc4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1e38e003b38148972586354723e9bc4">&#9670;&nbsp;</a></span>threshold_components_parallel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.source_extraction.cnmf.spatial.threshold_components_parallel </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>pars</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Post-processing of spatial components which includes the following steps. </p>
<p>(i) Median filtering (ii) Thresholding (iii) Morphological closing of spatial support (iv) Extraction of largest connected component /!\ need to be called through the function threshold components</p>
<h2>Parameters </h2>
<p>[parsed] A np.ndarray 2d matrix with spatial components</p>
<p>dims tuple dimensions of spatial components</p>
<p>medw [optional] tuple window of median filter</p>
<p>thr_method [optional] string Method of thresholding: 'max' sets to zero pixels that have value less than a fraction of the max value 'nrg' keeps the pixels that contribute up to a specified fraction of the energy</p>
<p>maxthr [optional] scalar Threshold of max value</p>
<p>nrgthr [optional] scalar Threshold of energy</p>
<p>extract_cc [optional] bool Flag to extract connected components (might want to turn to False for dendritic imaging)</p>
<p>se [optional] np.intarray Morphological closing structuring element</p>
<p>ss [optinoal] np.intarray Binary element for determining connectivity</p>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>Ath np.ndarray 2d matrix with spatial components thresholded </dd></dl>

<p class="definition">Definition at line <a class="el" href="spatial_8py_source.html#l00624">624</a> of file <a class="el" href="spatial_8py_source.html">spatial.py</a>.</p>

</div>
</div>
<a id="ac4b406f52054893ed2518a761921d4f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4b406f52054893ed2518a761921d4f4">&#9670;&nbsp;</a></span>update_spatial_components()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.source_extraction.cnmf.spatial.update_spatial_components </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>C</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>f</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>A_in</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>sn</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dims</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>min_size</em> = <code>3</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_size</em> = <code>8</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dist</em> = <code>3</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>normalize_yyt_one</em> = <code>True</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>method</em> = <code>'ellipse'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>expandCore</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dview</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>n_pixels_per_process</em> = <code>128</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>medw</em> = <code>(3,&#160;3)</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>thr_method</em> = <code>'nrg'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>maxthr</em> = <code>0.1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>nrgthr</em> = <code>0.9999</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>extract_cc</em> = <code>True</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>se</em> = <code>np.ones((3,&#160;3),&#160;dtype=np.int)</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ss</em> = <code>np.ones((3,&#160;3),&#160;dtype=np.int)</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>nb</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>method_ls</em> = <code>'lasso_lars'</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>update spatial footprints and background through Basis Pursuit Denoising </p>
<p>for each pixel i solve the problem [A(i,:),b(i)] = argmin sum(A(i,:)) subject to || Y(i,:) - A(i,:)*C + b(i)*f || &lt;= sn(i)*sqrt(T);</p>
<p>for each pixel the search is limited to a few spatial components</p>
<h2>Parameters </h2>
<p>Y np.ndarray (2D or 3D) movie, raw data in 2D or 3D (pixels x time).</p>
<p>C np.ndarray calcium activity of each neuron.</p>
<p>f np.ndarray temporal profile of background activity.</p>
<p>A_in np.ndarray spatial profile of background activity. If A_in is boolean then it defines the spatial support of A. Otherwise it is used to determine it through determine_search_location</p>
<p>dims [optional] tuple x, y[, z] movie dimensions</p>
<p>min_size [optional] int</p>
<p>max_size [optional] int</p>
<p>dist [optional] int</p>
<p>sn [optional] float noise associated with each pixel if known</p>
<p>backend [optional] str 'ipyparallel', 'single_thread' single_thread:no parallelization. It can be used with small datasets. ipyparallel uses ipython clusters and then send jobs to each of them SLURM use the slurm scheduler</p>
<p>n_pixels_per_process [optional] int number of pixels to be processed by each thread</p>
<p>method [optional] string method used to expand the search for pixels 'ellipse' or 'dilate'</p>
<p>expandCore [optional] scipy.ndimage.morphology if method is dilate this represents the kernel used for expansion</p>
<p>dview view on ipyparallel client you need to create an ipyparallel client and pass a view on the processors (client = Client(), dview=client[:])</p>
<p>medw, thr_method, maxthr, nrgthr, extract_cc, se, ss: [optional] Parameters for components post-processing. Refer to <a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html#a3fa5db8c88b06457233eb35dbcea3588" title="Post-processing of spatial components which includes the following steps. ">spatial.threshold_components</a> for more details</p>
<p>nb [optional] int Number of background components</p>
<p>method_ls: method to perform the regression for the basis pursuit denoising. 'nnls_L0'. Nonnegative least square with L0 penalty 'lasso_lars' lasso lars function from scikit learn 'lasso_lars_old' lasso lars from old implementation, will be deprecated</p>
<p>normalize_yyt_one bool wheter to norrmalize the C and A matrices so that diag(C*C.T) are ones</p>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>A np.ndarray new estimate of spatial footprints</dd>
<dd>
b np.ndarray new estimate of spatial background</dd>
<dd>
C np.ndarray temporal components (updated only when spatial components are completely removed)</dd>
<dd>
f np.ndarray same as f_in except if empty component deleted.</dd></dl>
<h2>Raise </h2>
<p>Exception('You need to define the input dimensions')</p>
<p>Exception('Dimension of Matrix Y must be pixels x time')</p>
<p>Exception('Dimension of Matrix C must be neurons x time')</p>
<p>Exception('Dimension of Matrix f must be background comps x time ')</p>
<p>Exception('Either A or C need to be determined')</p>
<p>Exception('Dimension of Matrix A must be pixels x neurons ')</p>
<p>Exception('You need to provide estimate of C and f')</p>
<p>Exception('Not implemented consistently')</p>
<p>Exception("Failed to delete: " + folder) </p>

<p class="definition">Definition at line <a class="el" href="spatial_8py_source.html#l00142">142</a> of file <a class="el" href="spatial_8py_source.html">spatial.py</a>.</p>
<div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_ac4b406f52054893ed2518a761921d4f4_cgraph.svg" width="867" height="255"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial_ac4b406f52054893ed2518a761921d4f4_icgraph.svg" width="550" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacecaiman.html">caiman</a></li><li class="navelem"><a class="el" href="namespacecaiman_1_1source__extraction.html">source_extraction</a></li><li class="navelem"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf.html">cnmf</a></li><li class="navelem"><a class="el" href="namespacecaiman_1_1source__extraction_1_1cnmf_1_1spatial.html">spatial</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
